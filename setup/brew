#!/bin/sh

source ./lib/util

# Ask for the administrator password upfront
sudo -v

# Make sure weâ€™re using the latest Homebrew
info "Update and upgrade brew"
brew update && brew upgrade

FORMULAS=(
  # Identity
  keybase

  # GNU core utilities (those that come with OS X are outdated)
  coreutils

  # GNU `find`, `locate`, `updatedb`, and `xargs`, g-prefixed
  findutils

  # Shells
  bash
  zsh

  # Wget with iri
  "wget --enable-iri"

  # Git
  git
  tig

  # Completion
  bash-completion
  docker-completion

  # Mah IDE
  # Uninstall first? Upgrade drops the override-system-vim
  "macvim --with-override-system-vim"
  tmux
  reattach-to-user-namespace

  # Useful tools
  trash
  ack
  the_silver_searcher
  rename
  todo-txt
  httpie
  fzf
  z

  # Languages
  node
  python
  python3
  
  # Ruby stuff
  rbenv
  ruby-build

  # Compilers
  make
  cmake
  mono

  # Gifiy
  ffmpeg
  gifsicle
  imagemagik
)

CASKS=(
  iterm2

  vagrant

  # Quicklook Add-ins
  qlcolorcode
  qlstephen
  qlmarkdown
  quicklook-json
  qlprettypatch
  quicklook-csv
  betterzipql
  qlimagesize
  suspicious-package

  # Gifify
  xquartz
)

formula_exists() {
  if $(brew list $1 > /dev/null); then
    return 0
  fi

  return 1
}

cask_exists() {
  if $(brew cask list $1 > /dev/null); then
    return 0
  fi

  return 1
}

for index in ${!FORMULAS[*]}
do
  if ! formula_exists ${FORMULAS[$index]}; then
    info "Installing ${FORMULAS[$index]}"
    brew install ${FORMULAS[$index]}
  else
    success "${FORMULAS[$index]} already installed, skipping"
  fi
done

for index in ${!CASKS[*]}
do
  if ! cask_exists ${CASKS[$index]}; then
    info "Installing cask ${CASKS[$index]}"
    brew cask isntall ${CASKS[$index]}
  else
    success "${CASKS[$index]} already installed, skipping"
  fi
done

# Taps
brew tap homebrew/dupes
brew tap homebrew/completions

# more recent versions of some OS X tools
brew install homebrew/dupes/grep

# TODO: Needed?
# open /usr/local/Cellar/x-quartz/2.7.4/XQuartz.pkg

brew linkapps

# Remove outdated versions from the cellar
brew cleanup
